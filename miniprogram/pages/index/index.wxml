<!--index.wxml-->
<view data-weui-theme="{{theme}}">
    <view class="weui-flex">
        <view wx:if="{{logged}}" class="top-bar userinfo {{themeBg}}-bg">
            <view class="userinfo-avatar">
                <image mode="heightFix" src="{{avatarUrl}}" />
            </view>
            <view class="userinfo-detail-wrapper">
                <text class="userinfo-nickname">{{ nickName }}</text>
                <text class="userinfo-address">{{ addressInfo }}</text>
            </view>
        </view>
        <view wx:else class="top-bar login">
            <button type="default" plain class="login-button" bindtap="onTapRegister">点击注册</button>
        </view>
    </view>
    <view class="weui-flex">
        <scroll-view class="scroll-wrapper" scroll-x scroll-with-animation="true" enable-flex="true" scroll-into-view="tab{{currentTab}}">
            <view class="navigate-item" id="tab{{index}}" wx:for="{{tabList}}" wx:key="index" data-index="{{index}}" bindtap="handleClick">
                <view class="names {{currentTab === index ? 'active' : ''}}">{{item.name}} <mp-badge wx:if="{{index==1 && event.ableToApply.length > 0}}" content="{{event.ableToApply.length}}" /></view>
                <view class="currtline {{currentTab === index ? 'active' : ''}}"></view>
            </view>
        </scroll-view>
    </view>
    <view>
        <swiper indicator-dots="{{false}}" bindchange="handleSwiper" current="{{currentTab}}">
            <swiper-item>
                <scroll-view scroll-y>
                    <mp-cells wx:if="{{ event.applied.length > 0 }}" title="已报名">
                        <mp-cell wx:for="{{ event.applied }}" wx:key="appliedEve" wx:for-item="eve" link-type="navigateTo" url="/pages/gift/gift?eid={{eve._id}}" link="{{true}}">
                            <view>
                                <view class="cell-title">{{ eve.eventName }}</view>
                                <view>结束于 {{ eve.timeFormatted }}</view>
                            </view>
                        </mp-cell>
                    </mp-cells>
                    <mp-cells wx:if="{{ event.publish.length > 0 }}" title="已抽签">
                        <mp-cell wx:for="{{ event.publish }}" wx:key="publishedEve" wx:for-item="eve" link-type="navigateTo" url="/pages/gift/gift?eid={{eve._id}}" link="{{true}}">
                            <view>
                                <view class="cell-title">{{ eve.eventName }}</view>
                                <view>结束于 {{ eve.timeFormatted }}</view>
                            </view>
                        </mp-cell>
                    </mp-cells>
                    <mp-cells wx:if="{{ event.end.length > 0 }}" title="已结束">
                        <mp-cell wx:for="{{ event.end }}" wx:key="endEve" wx:for-item="eve" link-type="navigateTo" url="/pages/gift/gift?eid={{eve._id}}" link="{{true}}">
                            <view>
                                <view class="cell-title">{{ eve.eventName }}</view>
                                <view>结束于 {{ eve.timeFormatted }}</view>
                            </view>
                        </mp-cell>
                    </mp-cells>
                </scroll-view>
            </swiper-item>
            <swiper-item>
                <scroll-view scroll-y>
                    <mp-cells>
                        <mp-cell wx:for="{{ event.ableToApply }}" wx:key="regEve" wx:for-item="eve" link-type="navigateTo" url="/pages/gift/gift?eid={{eve._id}}" link="{{true}}">
                            <view>
                                <view class="cell-title">{{ eve.eventName }}</view>
                                <view>结束于 {{ eve.timeFormatted }}</view>
                            </view>
                        </mp-cell>
                    </mp-cells>
                </scroll-view>
            </swiper-item>
            <swiper-item>
                <scroll-view scroll-y>
                    <mp-cells>
                        <mp-cell wx:for="{{ event.notStarted }}" wx:key="endEve" wx:for-item="eve" link-type="navigateTo" url="/pages/gift/gift?eid={{eve._id}}" link="{{true}}">
                            <view>
                                <view class="cell-title">{{ eve.eventName }}</view>
                                <view>结束于 {{ eve.timeFormatted }}</view>
                            </view>
                        </mp-cell>
                    </mp-cells>
                </scroll-view>
            </swiper-item>
        </swiper>
    </view>
</view>